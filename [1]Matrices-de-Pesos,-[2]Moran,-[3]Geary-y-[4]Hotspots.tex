% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={{[}1{]}Matrices-de-Pesos,-{[}2{]}Moran,-{[}3{]}Geary-y-{[}4{]}Hotspots.R},
  pdfauthor={ASUS Vivobook},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{{[}1{]}Matrices-de-Pesos,-{[}2{]}Moran,-{[}3{]}Geary-y-{[}4{]}Hotspots.R}
\author{ASUS Vivobook}
\date{2025-10-15}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# =============================================================================}
\CommentTok{\# SHINY APP COMPLETA {-} AN√ÅLISIS ESPACIAL PUNO1}
\CommentTok{\# =============================================================================}

\FunctionTok{library}\NormalTok{(shiny)}
\FunctionTok{library}\NormalTok{(shinydashboard)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Adjuntando el paquete: 'shinydashboard'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:graphics':
## 
##     box
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(spdep)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Cargando paquete requerido: spData
\end{verbatim}

\begin{verbatim}
## To access larger datasets in this package, install the spDataLarge
## package with: `install.packages('spDataLarge',
## repos='https://nowosad.github.io/drat/', type='source')`
\end{verbatim}

\begin{verbatim}
## Cargando paquete requerido: sf
\end{verbatim}

\begin{verbatim}
## Linking to GEOS 3.13.1, GDAL 3.11.0, PROJ 9.6.0; sf_use_s2() is TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(sf)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Adjuntando el paquete: 'dplyr'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:stats':
## 
##     filter, lag
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(leaflet)}
\FunctionTok{library}\NormalTok{(DT)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Adjuntando el paquete: 'DT'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:shiny':
## 
##     dataTableOutput, renderDataTable
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# UI {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{dashboardPage}\NormalTok{(}
  \AttributeTok{skin =} \StringTok{"blue"}\NormalTok{,}
  
  \FunctionTok{dashboardHeader}\NormalTok{(}
    \AttributeTok{title =} \StringTok{"AN√ÅLISIS ESPACIAL PUNO1"}\NormalTok{,}
    \AttributeTok{titleWidth =} \DecValTok{300}
\NormalTok{  ),}
  
  \FunctionTok{dashboardSidebar}\NormalTok{(}
    \AttributeTok{width =} \DecValTok{300}\NormalTok{,}
    \FunctionTok{sidebarMenu}\NormalTok{(}
      \AttributeTok{id =} \StringTok{"tabs"}\NormalTok{,}
      \FunctionTok{menuItem}\NormalTok{(}\StringTok{"üìä Dashboard Principal"}\NormalTok{, }\AttributeTok{tabName =} \StringTok{"dashboard"}\NormalTok{, }\AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"dashboard"}\NormalTok{)),}
      \FunctionTok{menuItem}\NormalTok{(}\StringTok{"üó∫Ô∏è Mapas Interactivos"}\NormalTok{, }\AttributeTok{tabName =} \StringTok{"mapas"}\NormalTok{, }\AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"map"}\NormalTok{)),}
      \FunctionTok{menuItem}\NormalTok{(}\StringTok{"üìã Resultados"}\NormalTok{, }\AttributeTok{tabName =} \StringTok{"resultados"}\NormalTok{, }\AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"table"}\NormalTok{)),}
      \FunctionTok{menuItem}\NormalTok{(}\StringTok{"‚ÑπÔ∏è Informaci√≥n"}\NormalTok{, }\AttributeTok{tabName =} \StringTok{"info"}\NormalTok{, }\AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"info{-}circle"}\NormalTok{))}
\NormalTok{    ),}
    
    \CommentTok{\# Panel de controles que aparece en todos los tabs}
    \FunctionTok{conditionalPanel}\NormalTok{(}
      \StringTok{\textquotesingle{}input.tabs !== "info"\textquotesingle{}}\NormalTok{,}
      \FunctionTok{hr}\NormalTok{(),}
      \FunctionTok{h4}\NormalTok{(}\StringTok{"Controles de An√°lisis"}\NormalTok{, }\AttributeTok{style =} \StringTok{"padding: 10px;"}\NormalTok{),}
      \FunctionTok{sliderInput}\NormalTok{(}\StringTok{"umbral\_distancia"}\NormalTok{, }\StringTok{"Umbral de Distancia:"}\NormalTok{, }
                  \AttributeTok{min =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{max =} \DecValTok{2}\NormalTok{, }\AttributeTok{value =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{step =} \FloatTok{0.1}\NormalTok{),}
      \FunctionTok{selectInput}\NormalTok{(}\StringTok{"tipo\_vecindad"}\NormalTok{, }\StringTok{"Tipo de Vecindad:"}\NormalTok{,}
                  \AttributeTok{choices =} \FunctionTok{c}\NormalTok{(}\StringTok{"Distancia"} \OtherTok{=} \StringTok{"distancia"}\NormalTok{,}
                              \StringTok{"K{-}Vecinos"} \OtherTok{=} \StringTok{"kvecinos"}\NormalTok{),}
                  \AttributeTok{selected =} \StringTok{"distancia"}\NormalTok{),}
      \FunctionTok{actionButton}\NormalTok{(}\StringTok{"calcular"}\NormalTok{, }\StringTok{"üîÑ Calcular An√°lisis"}\NormalTok{, }
                   \AttributeTok{class =} \StringTok{"btn{-}primary"}\NormalTok{, }\AttributeTok{width =} \StringTok{"100\%"}\NormalTok{)}
\NormalTok{    )}
\NormalTok{  ),}
  
  \FunctionTok{dashboardBody}\NormalTok{(}
\NormalTok{    tags}\SpecialCharTok{$}\FunctionTok{head}\NormalTok{(}
\NormalTok{      tags}\SpecialCharTok{$}\FunctionTok{style}\NormalTok{(}\FunctionTok{HTML}\NormalTok{(}\StringTok{"}
\StringTok{        .content{-}wrapper, .right{-}side \{}
\StringTok{          background{-}color: \#f4f4f4;}
\StringTok{        \}}
\StringTok{        .box \{}
\StringTok{          box{-}shadow: 0 4px 8px rgba(0,0,0,0.1);}
\StringTok{        \}}
\StringTok{      "}\NormalTok{))}
\NormalTok{    ),}
    
    \FunctionTok{tabItems}\NormalTok{(}
      \CommentTok{\# Dashboard tab}
      \FunctionTok{tabItem}\NormalTok{(}
        \AttributeTok{tabName =} \StringTok{"dashboard"}\NormalTok{,}
        \FunctionTok{h2}\NormalTok{(}\StringTok{"Dashboard de An√°lisis Espacial {-} Superficie PUNO1"}\NormalTok{),}
        
        \FunctionTok{fluidRow}\NormalTok{(}
          \CommentTok{\# Value boxes}
          \FunctionTok{valueBoxOutput}\NormalTok{(}\StringTok{"moran\_box"}\NormalTok{, }\AttributeTok{width =} \DecValTok{3}\NormalTok{),}
          \FunctionTok{valueBoxOutput}\NormalTok{(}\StringTok{"geary\_box"}\NormalTok{, }\AttributeTok{width =} \DecValTok{3}\NormalTok{),}
          \FunctionTok{valueBoxOutput}\NormalTok{(}\StringTok{"hotspots\_box"}\NormalTok{, }\AttributeTok{width =} \DecValTok{3}\NormalTok{),}
          \FunctionTok{valueBoxOutput}\NormalTok{(}\StringTok{"coldspots\_box"}\NormalTok{, }\AttributeTok{width =} \DecValTok{3}\NormalTok{)}
\NormalTok{        ),}
        
        \FunctionTok{fluidRow}\NormalTok{(}
          \FunctionTok{box}\NormalTok{(}
            \AttributeTok{title =} \StringTok{"üìà Diagrama de Dispersi√≥n de Moran"}\NormalTok{, }
            \AttributeTok{status =} \StringTok{"primary"}\NormalTok{, }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
            \AttributeTok{width =} \DecValTok{6}\NormalTok{,}
            \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"moran\_plot"}\NormalTok{, }\AttributeTok{height =} \DecValTok{400}\NormalTok{)}
\NormalTok{          ),}
          \FunctionTok{box}\NormalTok{(}
            \AttributeTok{title =} \StringTok{"üìä Distribuci√≥n de la Superficie"}\NormalTok{, }
            \AttributeTok{status =} \StringTok{"primary"}\NormalTok{, }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
            \AttributeTok{width =} \DecValTok{6}\NormalTok{,}
            \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"histograma"}\NormalTok{, }\AttributeTok{height =} \DecValTok{400}\NormalTok{)}
\NormalTok{          )}
\NormalTok{        ),}
        
        \FunctionTok{fluidRow}\NormalTok{(}
          \FunctionTok{box}\NormalTok{(}
            \AttributeTok{title =} \StringTok{"üß© Clusters LISA"}\NormalTok{, }
            \AttributeTok{status =} \StringTok{"info"}\NormalTok{, }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
            \AttributeTok{width =} \DecValTok{6}\NormalTok{,}
            \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"lisa\_plot"}\NormalTok{, }\AttributeTok{height =} \DecValTok{400}\NormalTok{)}
\NormalTok{          ),}
          \FunctionTok{box}\NormalTok{(}
            \AttributeTok{title =} \StringTok{"üî• Hotspots y Coldspots"}\NormalTok{, }
            \AttributeTok{status =} \StringTok{"info"}\NormalTok{, }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
            \AttributeTok{width =} \DecValTok{6}\NormalTok{,}
            \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"hotspots\_plot"}\NormalTok{, }\AttributeTok{height =} \DecValTok{400}\NormalTok{)}
\NormalTok{          )}
\NormalTok{        )}
\NormalTok{      ),}
      
      \CommentTok{\# Mapas tab}
      \FunctionTok{tabItem}\NormalTok{(}
        \AttributeTok{tabName =} \StringTok{"mapas"}\NormalTok{,}
        \FunctionTok{h2}\NormalTok{(}\StringTok{"Mapas Interactivos {-} An√°lisis Espacial"}\NormalTok{),}
        
        \FunctionTok{fluidRow}\NormalTok{(}
          \FunctionTok{box}\NormalTok{(}
            \AttributeTok{title =} \StringTok{"üó∫Ô∏è Mapa Interactivo"}\NormalTok{, }
            \AttributeTok{status =} \StringTok{"success"}\NormalTok{, }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
            \AttributeTok{width =} \DecValTok{12}\NormalTok{,}
            \FunctionTok{leafletOutput}\NormalTok{(}\StringTok{"mapa\_leaflet"}\NormalTok{, }\AttributeTok{height =} \DecValTok{600}\NormalTok{)}
\NormalTok{          )}
\NormalTok{        ),}
        
        \FunctionTok{fluidRow}\NormalTok{(}
          \FunctionTok{box}\NormalTok{(}
            \AttributeTok{title =} \StringTok{"üé® Configuraci√≥n del Mapa"}\NormalTok{, }
            \AttributeTok{width =} \DecValTok{12}\NormalTok{,}
            \FunctionTok{selectInput}\NormalTok{(}\StringTok{"tipo\_mapa"}\NormalTok{, }\StringTok{"Seleccionar Capa:"}\NormalTok{,}
                        \AttributeTok{choices =} \FunctionTok{c}\NormalTok{(}\StringTok{"Superficie (ha)"} \OtherTok{=} \StringTok{"superficie"}\NormalTok{,}
                                    \StringTok{"Clusters LISA"} \OtherTok{=} \StringTok{"lisa"}\NormalTok{,}
                                    \StringTok{"Hotspots/Coldspots"} \OtherTok{=} \StringTok{"hotspots"}\NormalTok{),}
                        \AttributeTok{selected =} \StringTok{"superficie"}\NormalTok{),}
            \FunctionTok{sliderInput}\NormalTok{(}\StringTok{"tamanio\_puntos"}\NormalTok{, }\StringTok{"Tama√±o de Puntos:"}\NormalTok{, }
                        \AttributeTok{min =} \DecValTok{3}\NormalTok{, }\AttributeTok{max =} \DecValTok{10}\NormalTok{, }\AttributeTok{value =} \DecValTok{6}\NormalTok{)}
\NormalTok{          )}
\NormalTok{        )}
\NormalTok{      ),}
      
      \CommentTok{\# Resultados tab}
      \FunctionTok{tabItem}\NormalTok{(}
        \AttributeTok{tabName =} \StringTok{"resultados"}\NormalTok{,}
        \FunctionTok{h2}\NormalTok{(}\StringTok{"Resultados y Datos del An√°lisis"}\NormalTok{),}
        
        \FunctionTok{fluidRow}\NormalTok{(}
          \FunctionTok{box}\NormalTok{(}
            \AttributeTok{title =} \StringTok{"üìã Resumen Estad√≠stico"}\NormalTok{, }
            \AttributeTok{status =} \StringTok{"warning"}\NormalTok{, }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
            \AttributeTok{width =} \DecValTok{12}\NormalTok{,}
            \FunctionTok{tableOutput}\NormalTok{(}\StringTok{"tabla\_resumen"}\NormalTok{)}
\NormalTok{          )}
\NormalTok{        ),}
        
        \FunctionTok{fluidRow}\NormalTok{(}
          \FunctionTok{box}\NormalTok{(}
            \AttributeTok{title =} \StringTok{"üìä Estad√≠sticas Descriptivas"}\NormalTok{, }
            \AttributeTok{width =} \DecValTok{6}\NormalTok{,}
            \FunctionTok{verbatimTextOutput}\NormalTok{(}\StringTok{"estadisticas\_descriptivas"}\NormalTok{)}
\NormalTok{          ),}
          \FunctionTok{box}\NormalTok{(}
            \AttributeTok{title =} \StringTok{"üîç Significancia Estad√≠stica"}\NormalTok{, }
            \AttributeTok{width =} \DecValTok{6}\NormalTok{,}
            \FunctionTok{verbatimTextOutput}\NormalTok{(}\StringTok{"significancia"}\NormalTok{)}
\NormalTok{          )}
\NormalTok{        ),}
        
        \FunctionTok{fluidRow}\NormalTok{(}
          \FunctionTok{box}\NormalTok{(}
            \AttributeTok{title =} \StringTok{"üíæ Datos Espaciales Completos"}\NormalTok{, }
            \AttributeTok{status =} \StringTok{"primary"}\NormalTok{, }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
            \AttributeTok{width =} \DecValTok{12}\NormalTok{,}
            \FunctionTok{downloadButton}\NormalTok{(}\StringTok{"descargar\_csv"}\NormalTok{, }\StringTok{"üì• Descargar CSV"}\NormalTok{, }
                           \AttributeTok{class =} \StringTok{"btn{-}success"}\NormalTok{),}
            \FunctionTok{downloadButton}\NormalTok{(}\StringTok{"descargar\_shp"}\NormalTok{, }\StringTok{"üì• Descargar Shapefile"}\NormalTok{,}
                           \AttributeTok{class =} \StringTok{"btn{-}info"}\NormalTok{),}
            \FunctionTok{br}\NormalTok{(), }\FunctionTok{br}\NormalTok{(),}
\NormalTok{            DT}\SpecialCharTok{::}\FunctionTok{dataTableOutput}\NormalTok{(}\StringTok{"tabla\_datos"}\NormalTok{)}
\NormalTok{          )}
\NormalTok{        )}
\NormalTok{      ),}
      
      \CommentTok{\# Informaci√≥n tab}
      \FunctionTok{tabItem}\NormalTok{(}
        \AttributeTok{tabName =} \StringTok{"info"}\NormalTok{,}
        \FunctionTok{h2}\NormalTok{(}\StringTok{"‚ÑπÔ∏è Informaci√≥n del Proyecto"}\NormalTok{),}
        
        \FunctionTok{fluidRow}\NormalTok{(}
          \FunctionTok{box}\NormalTok{(}
            \AttributeTok{title =} \StringTok{"üìö Acerca del An√°lisis"}\NormalTok{, }
            \AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{status =} \StringTok{"info"}\NormalTok{,}
            \FunctionTok{h3}\NormalTok{(}\StringTok{"An√°lisis Espacial de Superficie {-} PUNO1"}\NormalTok{),}
            \FunctionTok{p}\NormalTok{(}\StringTok{"Esta aplicaci√≥n realiza un an√°lisis espacial completo sobre la variable de superficie (P104\_SUP\_ha) de la base de datos PUNO1."}\NormalTok{),}
            \FunctionTok{br}\NormalTok{(),}
            \FunctionTok{h4}\NormalTok{(}\StringTok{"üìà M√©todos Implementados:"}\NormalTok{),}
\NormalTok{            tags}\SpecialCharTok{$}\FunctionTok{ul}\NormalTok{(}
\NormalTok{              tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"‚úÖ Matrices de Pesos Espaciales"}\NormalTok{),}
\NormalTok{              tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"‚úÖ Estad√≠stico I de Moran (Global y Local)"}\NormalTok{),}
\NormalTok{              tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"‚úÖ Estad√≠stico C de Geary"}\NormalTok{),}
\NormalTok{              tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"‚úÖ An√°lisis de Hotspots (Getis{-}Ord Gi*)"}\NormalTok{)}
\NormalTok{            ),}
            \FunctionTok{br}\NormalTok{(),}
            \FunctionTok{h4}\NormalTok{(}\StringTok{"üéØ Interpretaci√≥n:"}\NormalTok{),}
            \FunctionTok{p}\NormalTok{(}\StringTok{"‚Ä¢ Moran I \textgreater{} 0: Autocorrelaci√≥n espacial positiva (valores similares se agrupan)"}\NormalTok{),}
            \FunctionTok{p}\NormalTok{(}\StringTok{"‚Ä¢ Geary C \textless{} 1: Confirma autocorrelaci√≥n positiva"}\NormalTok{),}
            \FunctionTok{p}\NormalTok{(}\StringTok{"‚Ä¢ Hotspots: √Åreas con valores significativamente altos"}\NormalTok{),}
            \FunctionTok{p}\NormalTok{(}\StringTok{"‚Ä¢ Coldspots: √Åreas con valores significativamente bajos"}\NormalTok{)}
\NormalTok{          )}
\NormalTok{        )}
\NormalTok{      )}
\NormalTok{    )}
\NormalTok{  )}
\NormalTok{)}

\CommentTok{\# Server {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
  
  \CommentTok{\# Reactive data {-} Simulaci√≥n de datos PUNO1}
\NormalTok{  datos\_reactivos }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{}
\NormalTok{    input}\SpecialCharTok{$}\NormalTok{calcular  }\CommentTok{\# Depende del bot√≥n calcular}
    
    \CommentTok{\# Crear datos de ejemplo PUNO1}
    \FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{    n\_regiones }\OtherTok{\textless{}{-}} \DecValTok{50}
    
    \CommentTok{\# Coordenadas simuladas de Puno}
\NormalTok{    coords }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(}
      \AttributeTok{longitud =} \SpecialCharTok{{-}}\DecValTok{70} \SpecialCharTok{+} \FunctionTok{runif}\NormalTok{(n\_regiones, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{),}
      \AttributeTok{latitud =} \SpecialCharTok{{-}}\DecValTok{15} \SpecialCharTok{+} \FunctionTok{runif}\NormalTok{(n\_regiones, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{    )}
    
    \CommentTok{\# Crear variable superficie con autocorrelaci√≥n espacial}
\NormalTok{    superficie }\OtherTok{\textless{}{-}} \FunctionTok{numeric}\NormalTok{(n\_regiones)}
\NormalTok{    superficie[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{100}\NormalTok{, }\DecValTok{20}\NormalTok{)}
    
    \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{2}\SpecialCharTok{:}\NormalTok{n\_regiones) \{}
\NormalTok{      distancias }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{((coords[i,}\DecValTok{1}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ coords[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(i}\DecValTok{{-}1}\NormalTok{),}\DecValTok{1}\NormalTok{])}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{+} 
\NormalTok{                           (coords[i,}\DecValTok{2}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ coords[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(i}\DecValTok{{-}1}\NormalTok{),}\DecValTok{2}\NormalTok{])}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{      vecino }\OtherTok{\textless{}{-}} \FunctionTok{which.min}\NormalTok{(distancias)}
\NormalTok{      superficie[i] }\OtherTok{\textless{}{-}} \FloatTok{0.7} \SpecialCharTok{*}\NormalTok{ superficie[vecino] }\SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\NormalTok{    \}}
    
    \CommentTok{\# Asegurar valores positivos}
\NormalTok{    superficie }\OtherTok{\textless{}{-}} \FunctionTok{abs}\NormalTok{(superficie)}
    
    \CommentTok{\# Crear dataframe}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
      \AttributeTok{id =} \DecValTok{1}\SpecialCharTok{:}\NormalTok{n\_regiones,}
      \AttributeTok{CCDI =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%06d"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\NormalTok{n\_regiones),}
      \AttributeTok{NOMBREDI =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Distrito"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\NormalTok{n\_regiones),}
      \AttributeTok{P104\_SUP\_ha =} \FunctionTok{round}\NormalTok{(superficie, }\DecValTok{2}\NormalTok{),}
      \AttributeTok{longitud =}\NormalTok{ coords[,}\DecValTok{1}\NormalTok{],}
      \AttributeTok{latitud =}\NormalTok{ coords[,}\DecValTok{2}\NormalTok{]}
\NormalTok{    )}
    
    \CommentTok{\# Crear objeto espacial}
\NormalTok{    puno1\_sf }\OtherTok{\textless{}{-}} \FunctionTok{st\_as\_sf}\NormalTok{(datos, }\AttributeTok{coords =} \FunctionTok{c}\NormalTok{(}\StringTok{"longitud"}\NormalTok{, }\StringTok{"latitud"}\NormalTok{), }\AttributeTok{crs =} \DecValTok{4326}\NormalTok{)}
    
    \CommentTok{\# Crear matrices de pesos}
\NormalTok{    coords\_matrix }\OtherTok{\textless{}{-}} \FunctionTok{st\_coordinates}\NormalTok{(puno1\_sf)}
    
    \ControlFlowTok{if}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{tipo\_vecindad }\SpecialCharTok{==} \StringTok{"distancia"}\NormalTok{) \{}
\NormalTok{      nb }\OtherTok{\textless{}{-}} \FunctionTok{dnearneigh}\NormalTok{(coords\_matrix, }\DecValTok{0}\NormalTok{, input}\SpecialCharTok{$}\NormalTok{umbral\_distancia)}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      nb }\OtherTok{\textless{}{-}} \FunctionTok{knn2nb}\NormalTok{(}\FunctionTok{knearneigh}\NormalTok{(coords\_matrix, }\AttributeTok{k =} \DecValTok{5}\NormalTok{))}
\NormalTok{    \}}
    
\NormalTok{    w\_std }\OtherTok{\textless{}{-}} \FunctionTok{nb2listw}\NormalTok{(nb, }\AttributeTok{style =} \StringTok{"W"}\NormalTok{, }\AttributeTok{zero.policy =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{    w\_binaria }\OtherTok{\textless{}{-}} \FunctionTok{nb2listw}\NormalTok{(nb, }\AttributeTok{style =} \StringTok{"B"}\NormalTok{, }\AttributeTok{zero.policy =} \ConstantTok{TRUE}\NormalTok{)}
    
    \CommentTok{\# Calcular Moran Global}
\NormalTok{    moran\_global }\OtherTok{\textless{}{-}} \FunctionTok{moran.test}\NormalTok{(puno1\_sf}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha, w\_std, }\AttributeTok{zero.policy =} \ConstantTok{TRUE}\NormalTok{)}
    
    \CommentTok{\# Calcular Moran Local (LISA)}
\NormalTok{    local\_moran }\OtherTok{\textless{}{-}} \FunctionTok{localmoran}\NormalTok{(puno1\_sf}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha, w\_std, }\AttributeTok{zero.policy =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{    puno1\_sf}\SpecialCharTok{$}\NormalTok{lm\_i }\OtherTok{\textless{}{-}}\NormalTok{ local\_moran[,}\DecValTok{1}\NormalTok{]}
\NormalTok{    puno1\_sf}\SpecialCharTok{$}\NormalTok{lm\_pval }\OtherTok{\textless{}{-}}\NormalTok{ local\_moran[,}\DecValTok{5}\NormalTok{]}
    
    \CommentTok{\# Clasificar clusters LISA}
\NormalTok{    media\_superficie }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(puno1\_sf}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha)}
\NormalTok{    puno1\_sf}\SpecialCharTok{$}\NormalTok{lisa\_cluster }\OtherTok{\textless{}{-}} \StringTok{"No significativo"}
\NormalTok{    puno1\_sf}\SpecialCharTok{$}\NormalTok{lisa\_cluster[puno1\_sf}\SpecialCharTok{$}\NormalTok{lm\_pval }\SpecialCharTok{\textless{}} \FloatTok{0.05} \SpecialCharTok{\&}\NormalTok{ puno1\_sf}\SpecialCharTok{$}\NormalTok{lm\_i }\SpecialCharTok{\textgreater{}} \DecValTok{0} \SpecialCharTok{\&} 
\NormalTok{                            puno1\_sf}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha }\SpecialCharTok{\textgreater{}}\NormalTok{ media\_superficie] }\OtherTok{\textless{}{-}} \StringTok{"Alto{-}Alto"}
\NormalTok{    puno1\_sf}\SpecialCharTok{$}\NormalTok{lisa\_cluster[puno1\_sf}\SpecialCharTok{$}\NormalTok{lm\_pval }\SpecialCharTok{\textless{}} \FloatTok{0.05} \SpecialCharTok{\&}\NormalTok{ puno1\_sf}\SpecialCharTok{$}\NormalTok{lm\_i }\SpecialCharTok{\textgreater{}} \DecValTok{0} \SpecialCharTok{\&} 
\NormalTok{                            puno1\_sf}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha }\SpecialCharTok{\textless{}}\NormalTok{ media\_superficie] }\OtherTok{\textless{}{-}} \StringTok{"Bajo{-}Bajo"}
\NormalTok{    puno1\_sf}\SpecialCharTok{$}\NormalTok{lisa\_cluster[puno1\_sf}\SpecialCharTok{$}\NormalTok{lm\_pval }\SpecialCharTok{\textless{}} \FloatTok{0.05} \SpecialCharTok{\&}\NormalTok{ puno1\_sf}\SpecialCharTok{$}\NormalTok{lm\_i }\SpecialCharTok{\textless{}} \DecValTok{0} \SpecialCharTok{\&} 
\NormalTok{                            puno1\_sf}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha }\SpecialCharTok{\textgreater{}}\NormalTok{ media\_superficie] }\OtherTok{\textless{}{-}} \StringTok{"Alto{-}Bajo"}
\NormalTok{    puno1\_sf}\SpecialCharTok{$}\NormalTok{lisa\_cluster[puno1\_sf}\SpecialCharTok{$}\NormalTok{lm\_pval }\SpecialCharTok{\textless{}} \FloatTok{0.05} \SpecialCharTok{\&}\NormalTok{ puno1\_sf}\SpecialCharTok{$}\NormalTok{lm\_i }\SpecialCharTok{\textless{}} \DecValTok{0} \SpecialCharTok{\&} 
\NormalTok{                            puno1\_sf}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha }\SpecialCharTok{\textless{}}\NormalTok{ media\_superficie] }\OtherTok{\textless{}{-}} \StringTok{"Bajo{-}Alto"}
    
    \CommentTok{\# Calcular Geary}
\NormalTok{    geary\_global }\OtherTok{\textless{}{-}} \FunctionTok{geary.test}\NormalTok{(puno1\_sf}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha, w\_std, }\AttributeTok{zero.policy =} \ConstantTok{TRUE}\NormalTok{)}
    
    \CommentTok{\# Calcular Hotspots}
\NormalTok{    gi\_star }\OtherTok{\textless{}{-}} \FunctionTok{localG}\NormalTok{(puno1\_sf}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha, w\_binaria, }\AttributeTok{zero.policy =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{    puno1\_sf}\SpecialCharTok{$}\NormalTok{gi\_star }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(gi\_star)}
\NormalTok{    puno1\_sf}\SpecialCharTok{$}\NormalTok{gi\_pval }\OtherTok{\textless{}{-}} \DecValTok{2} \SpecialCharTok{*} \FunctionTok{pnorm}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{abs}\NormalTok{(puno1\_sf}\SpecialCharTok{$}\NormalTok{gi\_star))}
    
\NormalTok{    puno1\_sf}\SpecialCharTok{$}\NormalTok{hotspot\_cluster }\OtherTok{\textless{}{-}} \StringTok{"No significativo"}
\NormalTok{    puno1\_sf}\SpecialCharTok{$}\NormalTok{hotspot\_cluster[puno1\_sf}\SpecialCharTok{$}\NormalTok{gi\_pval }\SpecialCharTok{\textless{}} \FloatTok{0.05} \SpecialCharTok{\&}\NormalTok{ puno1\_sf}\SpecialCharTok{$}\NormalTok{gi\_star }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Hotspot"}
\NormalTok{    puno1\_sf}\SpecialCharTok{$}\NormalTok{hotspot\_cluster[puno1\_sf}\SpecialCharTok{$}\NormalTok{gi\_pval }\SpecialCharTok{\textless{}} \FloatTok{0.05} \SpecialCharTok{\&}\NormalTok{ puno1\_sf}\SpecialCharTok{$}\NormalTok{gi\_star }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Coldspot"}
    
    \CommentTok{\# Devolver resultados}
    \FunctionTok{list}\NormalTok{(}
      \AttributeTok{datos =}\NormalTok{ puno1\_sf,}
      \AttributeTok{moran =}\NormalTok{ moran\_global,}
      \AttributeTok{geary =}\NormalTok{ geary\_global,}
      \AttributeTok{w\_std =}\NormalTok{ w\_std,}
      \AttributeTok{nb =}\NormalTok{ nb}
\NormalTok{    )}
\NormalTok{  \})}
  
  \CommentTok{\# Value Boxes}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{moran\_box }\OtherTok{\textless{}{-}} \FunctionTok{renderValueBox}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\FunctionTok{valueBox}\NormalTok{(}\StringTok{"N/A"}\NormalTok{, }\StringTok{"Moran I"}\NormalTok{, }\AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"chart{-}line"}\NormalTok{), }\AttributeTok{color =} \StringTok{"red"}\NormalTok{))}
    
\NormalTok{    moran\_i }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{moran}\SpecialCharTok{$}\NormalTok{estimate[}\DecValTok{1}\NormalTok{], }\DecValTok{4}\NormalTok{)}
\NormalTok{    sig }\OtherTok{\textless{}{-}}\NormalTok{ datos}\SpecialCharTok{$}\NormalTok{moran}\SpecialCharTok{$}\NormalTok{p.value }\SpecialCharTok{\textless{}} \FloatTok{0.05}
\NormalTok{    color }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(sig, }\StringTok{"green"}\NormalTok{, }\StringTok{"red"}\NormalTok{)}
\NormalTok{    icono }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(sig, }\StringTok{"thumbs{-}up"}\NormalTok{, }\StringTok{"thumbs{-}down"}\NormalTok{)}
    
    \FunctionTok{valueBox}\NormalTok{(}
\NormalTok{      moran\_i, }
      \FunctionTok{paste}\NormalTok{(}\StringTok{"Moran I"}\NormalTok{, }\FunctionTok{ifelse}\NormalTok{(sig, }\StringTok{"(Sig.)"}\NormalTok{, }\StringTok{"(No Sig.)"}\NormalTok{)),}
      \AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(icono), }
      \AttributeTok{color =}\NormalTok{ color}
\NormalTok{    )}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{geary\_box }\OtherTok{\textless{}{-}} \FunctionTok{renderValueBox}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\FunctionTok{valueBox}\NormalTok{(}\StringTok{"N/A"}\NormalTok{, }\StringTok{"Geary C"}\NormalTok{, }\AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"chart{-}bar"}\NormalTok{), }\AttributeTok{color =} \StringTok{"red"}\NormalTok{))}
    
\NormalTok{    geary\_c }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{geary}\SpecialCharTok{$}\NormalTok{estimate[}\DecValTok{1}\NormalTok{], }\DecValTok{4}\NormalTok{)}
\NormalTok{    sig }\OtherTok{\textless{}{-}}\NormalTok{ datos}\SpecialCharTok{$}\NormalTok{geary}\SpecialCharTok{$}\NormalTok{p.value }\SpecialCharTok{\textless{}} \FloatTok{0.05}
\NormalTok{    color }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(sig, }\StringTok{"green"}\NormalTok{, }\StringTok{"red"}\NormalTok{)}
\NormalTok{    icono }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(sig, }\StringTok{"thumbs{-}up"}\NormalTok{, }\StringTok{"thumbs{-}down"}\NormalTok{)}
    
    \FunctionTok{valueBox}\NormalTok{(}
\NormalTok{      geary\_c, }
      \FunctionTok{paste}\NormalTok{(}\StringTok{"Geary C"}\NormalTok{, }\FunctionTok{ifelse}\NormalTok{(sig, }\StringTok{"(Sig.)"}\NormalTok{, }\StringTok{"(No Sig.)"}\NormalTok{)),}
      \AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(icono), }
      \AttributeTok{color =}\NormalTok{ color}
\NormalTok{    )}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{hotspots\_box }\OtherTok{\textless{}{-}} \FunctionTok{renderValueBox}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\FunctionTok{valueBox}\NormalTok{(}\StringTok{"N/A"}\NormalTok{, }\StringTok{"Hotspots"}\NormalTok{, }\AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"fire"}\NormalTok{), }\AttributeTok{color =} \StringTok{"red"}\NormalTok{))}
    
\NormalTok{    n\_hotspots }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos}\SpecialCharTok{$}\NormalTok{hotspot\_cluster }\SpecialCharTok{==} \StringTok{"Hotspot"}\NormalTok{)}
    
    \FunctionTok{valueBox}\NormalTok{(}
\NormalTok{      n\_hotspots, }\StringTok{"Hotspots Identificados"}\NormalTok{,}
      \AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"fire"}\NormalTok{), }\AttributeTok{color =} \StringTok{"orange"}
\NormalTok{    )}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{coldspots\_box }\OtherTok{\textless{}{-}} \FunctionTok{renderValueBox}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\FunctionTok{valueBox}\NormalTok{(}\StringTok{"N/A"}\NormalTok{, }\StringTok{"Coldspots"}\NormalTok{, }\AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"snowflake"}\NormalTok{), }\AttributeTok{color =} \StringTok{"red"}\NormalTok{))}
    
\NormalTok{    n\_coldspots }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos}\SpecialCharTok{$}\NormalTok{hotspot\_cluster }\SpecialCharTok{==} \StringTok{"Coldspot"}\NormalTok{)}
    
    \FunctionTok{valueBox}\NormalTok{(}
\NormalTok{      n\_coldspots, }\StringTok{"Coldspots Identificados"}\NormalTok{,}
      \AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"snowflake"}\NormalTok{), }\AttributeTok{color =} \StringTok{"blue"}
\NormalTok{    )}
\NormalTok{  \})}
  
  \CommentTok{\# Gr√°ficos}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{moran\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\ConstantTok{NULL}\NormalTok{)}
    
\NormalTok{    x\_std }\OtherTok{\textless{}{-}} \FunctionTok{scale}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha)}
\NormalTok{    w\_x }\OtherTok{\textless{}{-}} \FunctionTok{lag.listw}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{w\_std, x\_std, }\AttributeTok{zero.policy =} \ConstantTok{TRUE}\NormalTok{)}
    
    \FunctionTok{plot}\NormalTok{(x\_std, w\_x, }
         \AttributeTok{xlab =} \StringTok{"Superficie Estandarizada (ha)"}\NormalTok{, }
         \AttributeTok{ylab =} \StringTok{"Rezago Espacial"}\NormalTok{,}
         \AttributeTok{main =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Diagrama de Dispersi√≥n de Moran}\SpecialCharTok{\textbackslash{}n}\StringTok{I ="}\NormalTok{, }
                      \FunctionTok{round}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{moran}\SpecialCharTok{$}\NormalTok{estimate[}\DecValTok{1}\NormalTok{], }\DecValTok{3}\NormalTok{)),}
         \AttributeTok{pch =} \DecValTok{19}\NormalTok{, }\AttributeTok{col =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{cex =} \FloatTok{1.2}\NormalTok{)}
    \FunctionTok{abline}\NormalTok{(}\AttributeTok{h =} \DecValTok{0}\NormalTok{, }\AttributeTok{v =} \DecValTok{0}\NormalTok{, }\AttributeTok{lty =} \DecValTok{2}\NormalTok{, }\AttributeTok{col =} \StringTok{"gray"}\NormalTok{)}
    \FunctionTok{abline}\NormalTok{(}\FunctionTok{lm}\NormalTok{(w\_x }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x\_std), }\AttributeTok{col =} \StringTok{"red"}\NormalTok{, }\AttributeTok{lwd =} \DecValTok{2}\NormalTok{)}
    \FunctionTok{grid}\NormalTok{()}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{histograma }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\ConstantTok{NULL}\NormalTok{)}
    
    \FunctionTok{ggplot}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ P104\_SUP\_ha)) }\SpecialCharTok{+}
      \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{fill =} \StringTok{"steelblue"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{bins =} \DecValTok{20}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Distribuci√≥n de Superficies Agr√≠colas"}\NormalTok{,}
           \AttributeTok{x =} \StringTok{"Superficie (ha)"}\NormalTok{, }\AttributeTok{y =} \StringTok{"Frecuencia"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{))}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{lisa\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\ConstantTok{NULL}\NormalTok{)}
    
    \FunctionTok{ggplot}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos) }\SpecialCharTok{+}
      \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ lisa\_cluster), }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{scale\_fill\_manual}\NormalTok{(}
        \AttributeTok{name =} \StringTok{"Clusters LISA"}\NormalTok{,}
        \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"Alto{-}Alto"} \OtherTok{=} \StringTok{"\#d73027"}\NormalTok{, }\StringTok{"Bajo{-}Bajo"} \OtherTok{=} \StringTok{"\#4575b4"}\NormalTok{,}
                   \StringTok{"Alto{-}Bajo"} \OtherTok{=} \StringTok{"\#fdae61"}\NormalTok{, }\StringTok{"Bajo{-}Alto"} \OtherTok{=} \StringTok{"\#91bfdb"}\NormalTok{,}
                   \StringTok{"No significativo"} \OtherTok{=} \StringTok{"\#f0f0f0"}\NormalTok{)}
\NormalTok{      ) }\SpecialCharTok{+}
      \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Clusters de Autocorrelaci√≥n Local (LISA)"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{))}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{hotspots\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\ConstantTok{NULL}\NormalTok{)}
    
    \FunctionTok{ggplot}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos) }\SpecialCharTok{+}
      \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ hotspot\_cluster), }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{scale\_fill\_manual}\NormalTok{(}
        \AttributeTok{name =} \StringTok{"Hotspots/Coldspots"}\NormalTok{,}
        \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"Hotspot"} \OtherTok{=} \StringTok{"\#b2182b"}\NormalTok{, }\StringTok{"Coldspot"} \OtherTok{=} \StringTok{"\#2166ac"}\NormalTok{,}
                   \StringTok{"No significativo"} \OtherTok{=} \StringTok{"\#f0f0f0"}\NormalTok{)}
\NormalTok{      ) }\SpecialCharTok{+}
      \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Hotspots y Coldspots (Getis{-}Ord Gi*)"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{))}
\NormalTok{  \})}
  
  \CommentTok{\# Mapa Leaflet}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{mapa\_leaflet }\OtherTok{\textless{}{-}} \FunctionTok{renderLeaflet}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\ConstantTok{NULL}\NormalTok{)}
    
    \CommentTok{\# Preparar datos para el mapa}
\NormalTok{    map\_data }\OtherTok{\textless{}{-}}\NormalTok{ datos}\SpecialCharTok{$}\NormalTok{datos}
    
    \CommentTok{\# Definir paleta seg√∫n tipo de mapa}
    \ControlFlowTok{if}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{tipo\_mapa }\SpecialCharTok{==} \StringTok{"superficie"}\NormalTok{) \{}
\NormalTok{      pal }\OtherTok{\textless{}{-}} \FunctionTok{colorNumeric}\NormalTok{(}\StringTok{"viridis"}\NormalTok{, map\_data}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha)}
\NormalTok{      valores }\OtherTok{\textless{}{-}}\NormalTok{ map\_data}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha}
\NormalTok{      titulo }\OtherTok{\textless{}{-}} \StringTok{"Superficie (ha)"}
\NormalTok{    \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{tipo\_mapa }\SpecialCharTok{==} \StringTok{"lisa"}\NormalTok{) \{}
\NormalTok{      pal }\OtherTok{\textless{}{-}} \FunctionTok{colorFactor}\NormalTok{(}
        \FunctionTok{c}\NormalTok{(}\StringTok{"\#d73027"}\NormalTok{, }\StringTok{"\#4575b4"}\NormalTok{, }\StringTok{"\#fdae61"}\NormalTok{, }\StringTok{"\#91bfdb"}\NormalTok{, }\StringTok{"\#f0f0f0"}\NormalTok{),}
        \AttributeTok{domain =}\NormalTok{ map\_data}\SpecialCharTok{$}\NormalTok{lisa\_cluster}
\NormalTok{      )}
\NormalTok{      valores }\OtherTok{\textless{}{-}}\NormalTok{ map\_data}\SpecialCharTok{$}\NormalTok{lisa\_cluster}
\NormalTok{      titulo }\OtherTok{\textless{}{-}} \StringTok{"Clusters LISA"}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      pal }\OtherTok{\textless{}{-}} \FunctionTok{colorFactor}\NormalTok{(}
        \FunctionTok{c}\NormalTok{(}\StringTok{"\#b2182b"}\NormalTok{, }\StringTok{"\#2166ac"}\NormalTok{, }\StringTok{"\#f0f0f0"}\NormalTok{),}
        \AttributeTok{domain =}\NormalTok{ map\_data}\SpecialCharTok{$}\NormalTok{hotspot\_cluster}
\NormalTok{      )}
\NormalTok{      valores }\OtherTok{\textless{}{-}}\NormalTok{ map\_data}\SpecialCharTok{$}\NormalTok{hotspot\_cluster}
\NormalTok{      titulo }\OtherTok{\textless{}{-}} \StringTok{"Hotspots/Coldspots"}
\NormalTok{    \}}
    
    \CommentTok{\# Crear mapa}
    \FunctionTok{leaflet}\NormalTok{(map\_data) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{addProviderTiles}\NormalTok{(providers}\SpecialCharTok{$}\NormalTok{CartoDB.Positron) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{addCircleMarkers}\NormalTok{(}
        \AttributeTok{lng =} \FunctionTok{st\_coordinates}\NormalTok{(map\_data)[,}\DecValTok{1}\NormalTok{],}
        \AttributeTok{lat =} \FunctionTok{st\_coordinates}\NormalTok{(map\_data)[,}\DecValTok{2}\NormalTok{],}
        \AttributeTok{color =} \SpecialCharTok{\textasciitilde{}}\FunctionTok{pal}\NormalTok{(valores),}
        \AttributeTok{fillOpacity =} \FloatTok{0.8}\NormalTok{,}
        \AttributeTok{radius =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{tamanio\_puntos,}
        \AttributeTok{stroke =} \ConstantTok{TRUE}\NormalTok{,}
        \AttributeTok{weight =} \DecValTok{1}\NormalTok{,}
        \AttributeTok{popup =} \SpecialCharTok{\textasciitilde{}}\FunctionTok{paste}\NormalTok{(}
          \StringTok{"\textless{}b\textgreater{}Distrito:\textless{}/b\textgreater{} "}\NormalTok{, NOMBREDI, }\StringTok{"\textless{}br\textgreater{}"}\NormalTok{,}
          \StringTok{"\textless{}b\textgreater{}Superficie:\textless{}/b\textgreater{} "}\NormalTok{, }\FunctionTok{round}\NormalTok{(P104\_SUP\_ha, }\DecValTok{2}\NormalTok{), }\StringTok{" ha\textless{}br\textgreater{}"}\NormalTok{,}
          \StringTok{"\textless{}b\textgreater{}Cluster LISA:\textless{}/b\textgreater{} "}\NormalTok{, lisa\_cluster, }\StringTok{"\textless{}br\textgreater{}"}\NormalTok{,}
          \StringTok{"\textless{}b\textgreater{}Hotspot:\textless{}/b\textgreater{} "}\NormalTok{, hotspot\_cluster}
\NormalTok{        )}
\NormalTok{      ) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{addLegend}\NormalTok{(}
        \AttributeTok{position =} \StringTok{"bottomright"}\NormalTok{,}
        \AttributeTok{pal =}\NormalTok{ pal,}
        \AttributeTok{values =}\NormalTok{ valores,}
        \AttributeTok{title =}\NormalTok{ titulo,}
        \AttributeTok{opacity =} \DecValTok{1}
\NormalTok{      )}
\NormalTok{  \})}
  
  \CommentTok{\# Tablas y resultados}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{tabla\_resumen }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\ConstantTok{NULL}\NormalTok{)}
    
    \FunctionTok{data.frame}\NormalTok{(}
\NormalTok{      M√©trica }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"N√∫mero de Observaciones"}\NormalTok{, }\StringTok{"Superficie Promedio (ha)"}\NormalTok{, }
                  \StringTok{"Superficie M√≠nima (ha)"}\NormalTok{, }\StringTok{"Superficie M√°xima (ha)"}\NormalTok{,}
                  \StringTok{"Moran I"}\NormalTok{, }\StringTok{"Geary C"}\NormalTok{, }\StringTok{"Hotspots"}\NormalTok{, }\StringTok{"Coldspots"}\NormalTok{),}
      \AttributeTok{Valor =} \FunctionTok{c}\NormalTok{(}
        \FunctionTok{nrow}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos),}
        \FunctionTok{round}\NormalTok{(}\FunctionTok{mean}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha), }\DecValTok{2}\NormalTok{),}
        \FunctionTok{round}\NormalTok{(}\FunctionTok{min}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha), }\DecValTok{2}\NormalTok{),}
        \FunctionTok{round}\NormalTok{(}\FunctionTok{max}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha), }\DecValTok{2}\NormalTok{),}
        \FunctionTok{round}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{moran}\SpecialCharTok{$}\NormalTok{estimate[}\DecValTok{1}\NormalTok{], }\DecValTok{4}\NormalTok{),}
        \FunctionTok{round}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{geary}\SpecialCharTok{$}\NormalTok{estimate[}\DecValTok{1}\NormalTok{], }\DecValTok{4}\NormalTok{),}
        \FunctionTok{sum}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos}\SpecialCharTok{$}\NormalTok{hotspot\_cluster }\SpecialCharTok{==} \StringTok{"Hotspot"}\NormalTok{),}
        \FunctionTok{sum}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos}\SpecialCharTok{$}\NormalTok{hotspot\_cluster }\SpecialCharTok{==} \StringTok{"Coldspot"}\NormalTok{)}
\NormalTok{      )}
\NormalTok{    )}
\NormalTok{  \}, }\AttributeTok{bordered =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{striped =} \ConstantTok{TRUE}\NormalTok{)}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{estadisticas\_descriptivas }\OtherTok{\textless{}{-}} \FunctionTok{renderPrint}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\StringTok{"Cargando datos..."}\NormalTok{)}
    
    \FunctionTok{summary}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos}\SpecialCharTok{$}\NormalTok{P104\_SUP\_ha)}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{significancia }\OtherTok{\textless{}{-}} \FunctionTok{renderPrint}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\StringTok{"Cargando datos..."}\NormalTok{)}
    
    \FunctionTok{cat}\NormalTok{(}\StringTok{"Moran I {-} p{-}value:"}\NormalTok{, datos}\SpecialCharTok{$}\NormalTok{moran}\SpecialCharTok{$}\NormalTok{p.value, }
        \FunctionTok{ifelse}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{moran}\SpecialCharTok{$}\NormalTok{p.value }\SpecialCharTok{\textless{}} \FloatTok{0.05}\NormalTok{, }\StringTok{"(SIGNIFICATIVO)"}\NormalTok{, }\StringTok{"(NO SIGNIFICATIVO)"}\NormalTok{),}
        \StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}n}\StringTok{"}\NormalTok{)}
    \FunctionTok{cat}\NormalTok{(}\StringTok{"Geary C {-} p{-}value:"}\NormalTok{, datos}\SpecialCharTok{$}\NormalTok{geary}\SpecialCharTok{$}\NormalTok{p.value,}
        \FunctionTok{ifelse}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{geary}\SpecialCharTok{$}\NormalTok{p.value }\SpecialCharTok{\textless{}} \FloatTok{0.05}\NormalTok{, }\StringTok{"(SIGNIFICATIVO)"}\NormalTok{, }\StringTok{"(NO SIGNIFICATIVO)"}\NormalTok{))}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{tabla\_datos }\OtherTok{\textless{}{-}}\NormalTok{ DT}\SpecialCharTok{::}\FunctionTok{renderDataTable}\NormalTok{(\{}
\NormalTok{    datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(datos)) }\FunctionTok{return}\NormalTok{(}\ConstantTok{NULL}\NormalTok{)}
    
\NormalTok{    DT}\SpecialCharTok{::}\FunctionTok{datatable}\NormalTok{(}
      \FunctionTok{st\_drop\_geometry}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos) }\SpecialCharTok{\%\textgreater{}\%}
        \FunctionTok{select}\NormalTok{(id, CCDI, NOMBREDI, P104\_SUP\_ha, lisa\_cluster, hotspot\_cluster),}
      \AttributeTok{options =} \FunctionTok{list}\NormalTok{(}
        \AttributeTok{pageLength =} \DecValTok{10}\NormalTok{,}
        \AttributeTok{scrollX =} \ConstantTok{TRUE}\NormalTok{,}
        \AttributeTok{dom =} \StringTok{\textquotesingle{}Bfrtip\textquotesingle{}}\NormalTok{,}
        \AttributeTok{buttons =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}copy\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}excel\textquotesingle{}}\NormalTok{)}
\NormalTok{      ),}
      \AttributeTok{rownames =} \ConstantTok{FALSE}
\NormalTok{    )}
\NormalTok{  \})}
  
  \CommentTok{\# Descargas}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{descargar\_csv }\OtherTok{\textless{}{-}} \FunctionTok{downloadHandler}\NormalTok{(}
    \AttributeTok{filename =} \ControlFlowTok{function}\NormalTok{() \{}
      \FunctionTok{paste0}\NormalTok{(}\StringTok{"PUNO1\_analisis\_espacial\_"}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{(), }\StringTok{".csv"}\NormalTok{)}
\NormalTok{    \},}
    \AttributeTok{content =} \ControlFlowTok{function}\NormalTok{(file) \{}
\NormalTok{      datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
      \ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(datos)) \{}
        \FunctionTok{write.csv}\NormalTok{(}\FunctionTok{st\_drop\_geometry}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos), file, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{      \}}
\NormalTok{    \}}
\NormalTok{  )}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{descargar\_shp }\OtherTok{\textless{}{-}} \FunctionTok{downloadHandler}\NormalTok{(}
    \AttributeTok{filename =} \ControlFlowTok{function}\NormalTok{() \{}
      \FunctionTok{paste0}\NormalTok{(}\StringTok{"PUNO1\_datos\_espaciales\_"}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{(), }\StringTok{".zip"}\NormalTok{)}
\NormalTok{    \},}
    \AttributeTok{content =} \ControlFlowTok{function}\NormalTok{(file) \{}
\NormalTok{      datos }\OtherTok{\textless{}{-}} \FunctionTok{datos\_reactivos}\NormalTok{()}
      \ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(datos)) \{}
\NormalTok{        temp\_dir }\OtherTok{\textless{}{-}} \FunctionTok{tempdir}\NormalTok{()}
\NormalTok{        shapefile\_path }\OtherTok{\textless{}{-}} \FunctionTok{file.path}\NormalTok{(temp\_dir, }\StringTok{"puno1\_analisis"}\NormalTok{)}
        \FunctionTok{st\_write}\NormalTok{(datos}\SpecialCharTok{$}\NormalTok{datos, }\FunctionTok{paste0}\NormalTok{(shapefile\_path, }\StringTok{".shp"}\NormalTok{), }\AttributeTok{delete\_dsn =} \ConstantTok{TRUE}\NormalTok{)}
        \FunctionTok{zip}\NormalTok{(file, }\FunctionTok{list.files}\NormalTok{(temp\_dir, }\AttributeTok{pattern =} \StringTok{"puno1\_analisis"}\NormalTok{, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{))}
\NormalTok{      \}}
\NormalTok{    \}}
\NormalTok{  )}
\NormalTok{\}}

\CommentTok{\# Run the application }
\FunctionTok{shinyApp}\NormalTok{(}\AttributeTok{ui =}\NormalTok{ ui, }\AttributeTok{server =}\NormalTok{ server)}
\end{Highlighting}
\end{Shaded}


\end{document}
